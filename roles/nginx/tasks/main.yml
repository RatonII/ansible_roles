- name: added in 2.4, previously you used 'include'
  import_tasks: redhat.yml
  when: ansible_os_family == 'RedHat'
- import_tasks: debian.yml
  when: ansible_os_family == 'Debian'

- name: ensure nginx is running
  service: name=nginx state=started enabled=yes
- name: create sites-enabled directory and sites-available
  file:  name={{ item }} state=directory
  with_items: "{{ sites }}"
- name: modify config nginx
  template:  src=../templates/nginx.conf.j2  dest=/etc/nginx/nginx.conf
  notify: restart nginx
- name: generate dhparam cipher file
  command: openssl dhparam -out /etc/ssl/private/dhparam.pem 2048
- name: generate vhost config
  template: src=../templates/vhost.conf.j2   dest=/etc/nginx/sites-available/{{ item }}
  with_items: "{{ servers }}"
  notify: restart nginx
    
